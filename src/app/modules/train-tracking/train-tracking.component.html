<div class="tracking-container">
  <h2>🚂 تتبع القطار رقم {{ trainId }}</h2>
  
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
  
  <div *ngIf="trainData" class="train-info">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
      <div>
        <p><strong>🚂 رقم القطار:</strong> {{ trainData.TrainNo }}</p>
        <p><strong>📍 المحطة الحالية:</strong> {{ trainData.CurrentStationName }}</p>
        <p><strong>🎯 المحطة التالية:</strong> {{ trainData.NextStationName }}</p>
      </div>
      <div>
        <p><strong>📍 الإحداثيات:</strong> {{ trainData.Latitude }}, {{ trainData.Longitude }}</p>
        <p><strong>⏰ وقت الوصول المتوقع:</strong> {{ trainData.ExpectedArrival | date:'medium' }}</p>
        <p><strong>🚀 السرعة:</strong> {{ trainData.Speed }} كم/س</p>
      </div>
      <div>
        <p><strong>📏 المسافة إلى المحطة التالية:</strong> {{ trainData.DistanceToNextStation }} كم</p>
        <p><strong>📊 الحالة:</strong> {{ trainData.Status }}</p>
        <p><strong>🕒 آخر تحديث:</strong> {{ trainData.LastUpdated | date:'medium' }}</p>
      </div>
    </div>
  </div>

  <div *ngIf="!trainData && !isLoading" class="alert alert-info">
    <div style="text-align: center; padding: 20px;">
      <div style="font-size: 48px; margin-bottom: 10px;">🚂</div>
      <p>جاري تحميل بيانات القطار...</p>
    </div>
  </div>

  <ng-container *ngIf="isGuide">
    <div class="map-container">
      <div leaflet [leafletOptions]="options" [leafletLayers]="layers"></div>
    </div>

    <div class="controls">
      <div class="buttons-container">
        <button class="btn btn-primary" (click)="updateGps()" [disabled]="isLoading">
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          📍 تحديث GPS
        </button>
      </div>

      <h3>✏️ تحديث يدوي</h3>
      <form #manualForm="ngForm" (ngSubmit)="updateManual()">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
          <div class="form-group">
            <label for="latitude">📍 خط العرض</label>
            <input 
              type="number" 
              id="latitude"
              class="form-control" 
              [(ngModel)]="manualLat" 
              name="manualLat" 
              placeholder="مثال: 30.0444"
              required
              step="0.000001"
              min="-90"
              max="90"
            >
          </div>
          <div class="form-group">
            <label for="longitude">📍 خط الطول</label>
            <input 
              type="number" 
              id="longitude"
              class="form-control" 
              [(ngModel)]="manualLng" 
              name="manualLng" 
              placeholder="مثال: 31.2357"
              required
              step="0.000001"
              min="-180"
              max="180"
            >
          </div>
          <div class="form-group">
            <label for="arrival">⏰ وقت الوصول</label>
            <input 
              type="datetime-local" 
              id="arrival"
              class="form-control" 
              [(ngModel)]="manualArrival" 
              name="manualArrival"
              required
            >
          </div>
        </div>
        <button 
          type="submit" 
          class="btn btn-success" 
          [disabled]="manualForm.invalid || isLoading"
        >
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          ✅ تحديث يدوي
        </button>
      </form>
    </div>
  </ng-container>
</div>