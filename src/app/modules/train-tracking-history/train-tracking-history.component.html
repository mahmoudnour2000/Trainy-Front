<div class="history-container">
  <h2>سجل تتبع القطار رقم {{ trainId }}</h2>
  
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
  
  <div class="filter-form">
    <div class="form-group">
      <label>من تاريخ:</label>
      <input type="date" class="form-control" [(ngModel)]="startDate" [max]="endDate">
    </div>
    <div class="form-group">
      <label>إلى تاريخ:</label>
      <input type="date" class="form-control" [(ngModel)]="endDate" [min]="startDate" [max]="currentDate">
    </div>
    <button class="btn btn-primary" (click)="filterHistory()" [disabled]="isLoading">
      <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      تصفية
    </button>
  </div>

  <div *ngIf="isLoading" class="text-center my-3">
    <div class="spinner-border" role="status">
      <span class="sr-only">جاري التحميل...</span>
    </div>
  </div>

  <div *ngIf="!isLoading">
    <div *ngIf="history.length === 0" class="alert alert-info">
      لا توجد سجلات تتبع في الفترة المحددة
    </div>

    <table *ngIf="history.length > 0" class="table table-striped">
      <thead>
        <tr>
          <th>التاريخ</th>
          <th>المحطة الحالية</th>
          <th>المحطة التالية</th>
          <th>الإحداثيات</th>
          <th>السرعة</th>
          <th>المسافة المتبقية</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let entry of history">
          <td>{{ entry.LastUpdated | date:'medium' }}</td>
          <td>{{ entry.CurrentStationName }}</td>
          <td>{{ entry.NextStationName }}</td>
          <td>{{ entry.Latitude }}, {{ entry.Longitude }}</td>
          <td>{{ entry.Speed }} كم/س</td>
          <td>{{ entry.DistanceToNextStation }} كم</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>