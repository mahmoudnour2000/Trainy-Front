<div class="verification-status-container">
  <div class="verification-status-card">
    <h2 class="title">حالة التحقق</h2>
    
    <div class="spinner-container" *ngIf="loading">
      <app-spinner></app-spinner>
    </div>
    
    <!-- Success/Info message -->
    <div class="alert alert-info" *ngIf="successMessage">
      <i class="bi bi-info-circle-fill me-2"></i>
      {{ successMessage }}
    </div>
    
    <!-- Error message -->
    <div class="alert alert-danger" *ngIf="errorMessage">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      {{ errorMessage }}
      <button class="btn btn-sm btn-outline-danger ms-3" (click)="refreshStatus()">
        <i class="bi bi-arrow-clockwise me-1"></i> إعادة المحاولة
      </button>
    </div>
    
    <ng-container *ngIf="!loading && !errorMessage">
      <ng-container *ngIf="currentStatus$ | async as verificationStatus">
        <!-- Main verification status display -->
        <div class="verification-status-main">
          <div class="status-icon">
            <i [class]="'bi ' + getStatusIcon(getCombinedStatus()) + ' status-icon-large'"></i>
          </div>
          
          <div class="status-info">
            <div class="status-badge" [ngClass]="getStatusClass(getCombinedStatus())">
              {{ getStatusText(getCombinedStatus()) }}
            </div>
            
            <div class="status-description">
              <p>{{ getCombinedStatusDescription() }}</p>
            </div>
            
            <!-- Processing time message -->
            <div class="processing-time-notice" *ngIf="getCombinedStatus() === 'Pending'">
              <div class="notice-content">
                <i class="bi bi-clock me-2"></i>
                <span>تستغرق عملية المراجعة حوالي 24 ساعة</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Detailed verification status breakdown -->
        <div class="detailed-status-section" *ngIf="verificationStatus.verificationRequests.length > 0">
          <h4 class="details-title">تفاصيل التحقق</h4>
          
          <div class="verification-details">
            <!-- Sender verification status -->
            <div class="verification-box">
              <div class="role-title">
                <i class="bi bi-send"></i>
                <h5>المرسل</h5>
              </div>
              <div class="role-status">
                <span class="status-badge small" [ngClass]="getStatusClass(verificationStatus.senderStatus)">
                  {{ getStatusText(verificationStatus.senderStatus) }}
                </span>
                <p *ngIf="verificationStatus.senderStatus === 'Rejected' && verificationStatus.lastSenderRejectionReason" 
                   class="rejection-reason">
                  السبب: {{ verificationStatus.lastSenderRejectionReason }}
                </p>
              </div>
            </div>

            <!-- Courier verification status -->
            <div class="verification-box">
              <div class="role-title">
                <i class="bi bi-truck"></i>
                <h5>الموصل</h5>
              </div>
              <div class="role-status">
                <span class="status-badge small" [ngClass]="getStatusClass(verificationStatus.courierStatus)">
                  {{ getStatusText(verificationStatus.courierStatus) }}
                </span>
                <p *ngIf="verificationStatus.courierStatus === 'Rejected' && verificationStatus.lastCourierRejectionReason" 
                   class="rejection-reason">
                  السبب: {{ verificationStatus.lastCourierRejectionReason }}
                </p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Action buttons -->
        <div class="navigation-section">
          <div class="navigation-buttons">
            <!-- Start verification button for NotSubmitted status -->
            <button 
              *ngIf="getCombinedStatus() === 'NotSubmitted'"
              class="submit-btn start-verification-btn me-2"
              (click)="goToVerificationForm()"
            >
              <i class="bi bi-upload me-2"></i>
              بدء التحقق
            </button>
            
            <!-- Retry button for rejected status -->
            <button 
              *ngIf="getCombinedStatus() === 'Rejected'"
              class="submit-btn retry-btn me-2"
              (click)="goToVerificationForm()"
            >
              <i class="bi bi-arrow-clockwise me-2"></i>
              إعادة المحاولة
            </button>
            
            <!-- Main navigation to offers page for accepted users -->
            <button 
              *ngIf="getCombinedStatus() === 'Accepted'" 
              class="submit-btn primary-action me-2" 
              (click)="goToOffers()"
            >
              <i class="bi bi-box me-2"></i>
              انتقل إلى صفحة العروض
            </button>
            
            <!-- Home navigation button -->
            <button class="outline-btn" (click)="goToHome()">
              <i class="bi bi-house me-1"></i> العودة للرئيسية
            </button>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </div>
</div> 